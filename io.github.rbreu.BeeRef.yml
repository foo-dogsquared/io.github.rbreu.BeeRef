app-id: io.github.rbreu.BeeRef
runtime: org.kde.Platform
runtime-version: "5.15"
sdk: org.kde.Sdk
command: beeref
finish-args:
  - --filesystem=home
  - --socket=wayland
  - --socket=fallback-x11
rename-desktop-file: beeref.desktop
rename-icon: logo

modules:
  - name: qt-base
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DQT_BUILD_EXAMPLES=OFF
      - -DQT_BUILD_TESTS=OFF
    sources:
      - type: git
        url: git://code.qt.io/qt/qtbase.git
        tag: v6.2.0
        commit: cc60cf83db6bbf9775b1f7747a48d6b7eb24e585

  # The following shouldn't be manually edited.
  # It is generated from the `flatpak-builder-tools` (https://github.com/flatpak/flatpak-builder-tools).
  # You should be able to generate one by running the following command:
  #
  # > flatpak-builder-tools/pip/flatpak-pip-generator -o python3-setup.json <PACKAGES_IN_setup.py>...
  #
  # Note that PyQt and its related packages are not included because they are a bit of a pain to include.
  # See the related issue: https://github.com/flatpak/flatpak-builder-tools/issues/26
  - ./deps/python3-setup.json
  - ./deps/python3-sip.json
  - ./deps/python3-PyQt6-sip.json
  - ./deps/python3-PyQt-builder.json
  - ./deps/python3-PyQt6.json
  - ./deps/python3-pyinstaller.json

  # The application itself.
  # It seems to be a convention that the very project should be the last module.
  - name: beeref
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --prefix=/app --no-deps .
      - install -Dm644 beeref.desktop -t /app/share/applications/
      - install -Dm644 beeref/assets/logo.svg -t /app/share/icons/hicolor/scalable/apps/
    sources:
      - type: git
        url: https://github.com/rbreu/beeref.git
        branch: main
        commit: cf55d1a5e304da707f2cc9a9ca793ee24503a0bc
      - type: patch
        path: ./patches/update-desktop-file.patch
      - type: patch
        path: ./patches/remove-dependencies.patch
